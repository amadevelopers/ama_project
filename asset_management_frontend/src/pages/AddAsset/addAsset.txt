import React, { useState } from 'react'
import { useParams } from 'react-router-dom';

import '../../css/addAsset.css'
import details from './tagAssetDetails.json'
import assetTypeList from './assetType.json'
import noTagDetails from './noTagAssetDetails.json'
function AddAsset() {
    const [assetSubType, setassetSubType] = useState('')
    const [tagSerialNo, settagSerialNo] = useState('')
    const [tagAssetSpecsDisplay, settagAssetSpecsDisplay] = useState(false)
    const [specsToBeEdited, setspecsToBeEdited] = useState('')
    const [newSpecsValue, setnewSpecsValue] = useState('')
    const [specsObj, setSpecsObj] = useState({});
    const [qtyOfAsset, setqtyOfAsset] = useState('')
    const [assetType, setassetType] = useState('')
    const [formSubmitted, setformSubmitted] = useState(true);
    const initialShowAssetDetails = Array.from({ length: qtyOfAsset }, () => false);
    const [showAssetDetails, setShowAssetDetails] = useState(initialShowAssetDetails);
    const [renderedAssetCount, setRenderedAssetCount] = useState(0);
    var i = 0
    const handleAssetSubType = async (e) => {
        await setassetSubType(e.target.value)
    }

    const handleTagAssetSerialNo = async (e) => {
        settagSerialNo(e.target.value)
        await console.log(e.target.value)
    }
    const handleSubmitAssetTye = (e) => {
        //call the api to get the specs of the asset
        e.preventDefault()
        settagAssetSpecsDisplay(true);
    }

    const handleSubmitSpecs = async (e) => {
        //call api for sending the new specs
        e.preventDefault();
        await setSpecsObj({ [specsToBeEdited]: newSpecsValue });

        console.log("specs", specsObj)
        //added newly
        setspecsToBeEdited('');
        setnewSpecsValue('');
    }

    const handleAssetTypeSelection = (e) => {
        setassetType(e.target.value)
    }

    var newQty = qtyOfAsset;
    const handleformSubmitted = (data, index) => {
        // Update the state in the parent component with data from the child
        // i++
        // index = i
        setRenderedAssetCount(setRenderedAssetCount+1)
        setformSubmitted(data);
        // setShowAssetDetails([true]);

        const updatedShowAssetDetails = [...showAssetDetails];
        updatedShowAssetDetails[renderedAssetCount] = !updatedShowAssetDetails[renderedAssetCount];
        setShowAssetDetails(updatedShowAssetDetails);
        console.log(updatedShowAssetDetails)
        setRenderedAssetCount(renderedAssetCount + 1);
    }
    return (
        <div>
            <div className='add-asset-radio-selector'>
                <h3>Enter the type of Asset</h3>
                <div className='asset-radio-main-container'>
                    <div className='asset-type-selector'>
                        <input type='radio' name='tag' value='tag' onChange={handleAssetSubType}></input>
                        <label htmlFor='typeOfAsset'>Tag</label>
                    </div>
                    <div className='asset-type-selector'>
                        <input type='radio' name='tag' value='notag' onChange={handleAssetSubType}></input>
                        <label htmlFor='typeOfAsset'>No Tag</label>
                    </div>
                </div>
            </div>

            {
                assetSubType === 'tag' &&
                <div className='add-asset-tag-main'>
                    <form className='add-asset-tag-sub' onSubmit={handleSubmitAssetTye}>
                        <label htmlFor=''>Enter the serial No of the asset</label>
                        <input type='text' name='serialNo' value={tagSerialNo} onChange={handleTagAssetSerialNo}></input>
                        <button type='submit'>Submit</button>
                    </form>
                    {
                        tagAssetSpecsDisplay &&
                        <div className='tag-assets-specs-main'>
                            <p>{details[1].assetType}</p>
                            <div className='tag-assets-container'>
                                {Object.keys(details[1].specifications).map((key, value) => {
                                    return (
                                        <div className='tag-assets-specs-sub'>
                                            <p>{key}</p>
                                            <p>{details[1].specifications[key]}</p>
                                        </div>
                                    )
                                })}
                            </div>
                            <form onSubmit={handleSubmitSpecs}>
                                <div>
                                    <label htmlFor='editSpecs'>Enter the specification which you would like to change</label>
                                    <input type='text' name='editSpecs' value={specsToBeEdited} onChange={(e) => setspecsToBeEdited(e.target.value)}></input>
                                </div>
                                <div>
                                    <label htmlFor='editSpecs'>Enter the new value </label>
                                    <input type='text' name='newSpecs' value={newSpecsValue} onChange={(e) => setnewSpecsValue(e.target.value)}></input>
                                </div>
                                <button type="submit">Submit</button>
                            </form>

                        </div>
                    }

                </div>
            }

            {
                assetSubType === 'notag' &&
                <div>
                    <div>
                        <label htmlFor='qtyOfAsset'>Enter the quantity of assets to be added</label>
                        <input type='number' name='qtyOfAsset' value={qtyOfAsset} onChange={(e) => setqtyOfAsset(e.target.value)}></input>
                    </div>
                    <div className=''>
                        <label htmlFor='assetType'>Asset Type: </label>
                        <select id='assetTypeDropdown' name='assetTpe' value={assetType} onChange={handleAssetTypeSelection} >
                            <option value="">--Select Asset Type--</option>
                            {assetTypeList.assetTypes.map((key, value) => {
                                return (
                                    <option value={key}>{key}</option>
                                )
                            })}
                        </select>
                    </div>
                    <div>

                        {formSubmitted && (!showAssetDetails[renderedAssetCount]) &&
                            <AssetDetails assetType={assetType} onDataUpdate={handleformSubmitted} />
                        }
                    </div>
                </div>
            }
        </div>
    )
}



function AssetDetails(props) {
    const { assetType } = props
    const [specs, setspecs] = useState([])
    const [formSubmitted, setFormSubmitted] = useState(true);
    const [specsValues, setspecsValues] = useState({})

    const handleSpecsSelection = (e, specName) => {
        const newSpecsValues = { ...specsValues };
        newSpecsValues[specName] = e.target.value;
        setspecsValues(newSpecsValues);
    }

    const handleSave = () => {
        console.log(specsValues)
        setFormSubmitted(true);
        setspecsValues({})
        props.onDataUpdate(formSubmitted);
    };
    return (
        <div>
            {assetType &&
                <form onSubmit={handleSave}>
                    {Object.keys(noTagDetails[assetType]).map((value, index) => {
                        return (
                            <div key={index}>
                                <label htmlFor='specsInput'>{value}</label>
                                <input type='text' value={specs[value]} onChange={(e) => handleSpecsSelection(e, value)}></input>
                            </div>
                        )
                    })}
                    <button type='submit'>Save</button>
                </form>
            }
        </div>
    );
}

export { AddAsset, AssetDetails }